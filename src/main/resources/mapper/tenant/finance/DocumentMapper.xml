<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.multi.y2k4.mapper.finance.DocumentMapper">

    <!--
        Documents VO 필드와 DB documents 테이블 컬럼 매핑:
        docId -> doc_id
        requesterId -> req_id
        requestDate -> req_date
        approvalDate -> appr_date
        approverId -> appr_id
        status (String) -> status (tinyint)

        주의: status는 DB에서 tinyint이지만, VO에서 String으로 처리하므로 쿼리에서 변환 필요
        현재는 간소화된 쿼리를 사용합니다.
    -->

    <select id="listDocuments" resultType="com.multi.y2k4.vo.finance.Documents">
        SELECT
        doc_id AS docId,
        req_id AS requesterId,
        req_date AS requestDate,
        title,
        content,
        appr_id AS approverId,
        appr_date AS approvalDate,
        -- status (tinyint)를 문자열로 변환 (DB 스키마에 따라 실제 변환 로직은 달라질 수 있음)
        CASE
        WHEN status = 0 THEN 'PENDING'
        WHEN status = 1 THEN 'APPROVED'
        WHEN status = 2 THEN 'REJECTED'
        ELSE 'UNKNOWN'
        END AS status
        FROM
        documents
        <where>
            <if test="requesterId != null">
                AND req_id = #{requesterId}
            </if>
            <if test="status != null and status != ''">
                AND status =
                CASE
                WHEN #{status} = 'PENDING' THEN 0
                WHEN #{status} = 'APPROVED' THEN 1
                WHEN #{status} = 'REJECTED' THEN 2
                ELSE status
                END
            </if>
        </where>
        ORDER BY req_date DESC
    </select>

</mapper>