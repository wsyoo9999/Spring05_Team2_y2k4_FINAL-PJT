<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.multi.y2k4.mapper.tenant.inventory.InboundMapper">

    <!-- 전체 목록: emp_name 조인 -->
    <select id="list_all" resultType="com.multi.y2k4.vo.inventory.Inbound">
        SELECT i.*, e.emp_name AS emp_name
        FROM inbound i
                 LEFT JOIN human_resource e
                           ON e.emp_id = i.emp_id
    </select>

    <!-- 조건 검색: emp_name 조인 + 조건에 alias 붙이기 -->
    <select id="list" resultType="com.multi.y2k4.vo.inventory.Inbound">
        SELECT i.*, e.emp_name AS emp_name
        FROM inbound i
        LEFT JOIN human_resource e
        ON e.emp_id = i.emp_id
        <where>
            <if test="inbound_date != null">
                AND DATE(i.inbound_date) = #{inbound_date}
            </if>

            <if test="stock_id != null">
                AND i.stock_id = #{stock_id}
            </if>

            <if test="ac_id != null">
                AND i.ac_id = #{ac_id}
            </if>

            <if test="emp_id != null">
                AND i.emp_id = #{emp_id}
            </if>

            <if test="approval != null">
                AND i.approval = #{approval}
            </if>
        </where>
    </select>

    <insert id="addInbound"
            parameterType="com.multi.y2k4.vo.inventory.Inbound"
            useGeneratedKeys="true" keyProperty="inbound_id" keyColumn="inbound_id">
        INSERT INTO inbound
        (inbound_date, stock_id, inbound_qty, unit_price, ac_id, emp_id, remark, approval)
        VALUES
            (#{inbound_date}, #{stock_id}, #{inbound_qty}, #{unit_price},
             #{ac_id}, #{emp_id}, #{remark}, #{approval})
    </insert>

    <!-- 단건 조회: emp_name 조인 -->
    <select id="selectInboundById" resultType="com.multi.y2k4.vo.inventory.Inbound">
        SELECT i.*, e.emp_name AS emp_name
        FROM inbound i
                 LEFT JOIN human_resource e
                           ON e.emp_id = i.emp_id
        WHERE i.inbound_id = #{inbound_id}
    </select>

    <update id="updateInbound" parameterType="com.multi.y2k4.vo.inventory.Inbound">
        UPDATE inbound
        <set>
            <if test="inbound_date != null"> inbound_date = #{inbound_date}, </if>
            <if test="stock_id     != null"> stock_id     = #{stock_id},     </if>
            <if test="inbound_qty  != null"> inbound_qty  = #{inbound_qty},  </if>
            <if test="unit_price   != null"> unit_price   = #{unit_price},   </if>
            <if test="emp_id       != null"> emp_id       = #{emp_id},       </if>
            remark = #{remark},
            <if test="approval     != null"> approval     = #{approval},     </if>
        </set>
        WHERE inbound_id = #{inbound_id}
    </update>

    <delete id="deleteInbound" parameterType="com.multi.y2k4.vo.inventory.Inbound">
        DELETE FROM inbound
        WHERE inbound_id = #{inbound_id}
    </delete>
</mapper>
