<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.multi.y2k4.mapper.tenant.inventory.OutboundMapper">

    <!-- 전체 조회: ac_name, emp_name 조인 -->
    <select id="list_all" resultType="com.multi.y2k4.vo.inventory.Outbound">
        SELECT o.*,
            a.ac_name      AS ac_name,
            h.emp_name     AS emp_name
        FROM outbound o
                 LEFT JOIN accounts a
                           ON a.ac_id = o.ac_id
                 LEFT JOIN human_resource h
                           ON h.emp_id = o.emp_id
    </select>

    <!-- 조건 조회: ac_name, emp_name 조인 + alias 사용 -->
    <select id="list" resultType="com.multi.y2k4.vo.inventory.Outbound">
        SELECT o.*,
        a.ac_name      AS ac_name,
        h.emp_name     AS emp_name
        FROM outbound o
        LEFT JOIN accounts a
        ON a.ac_id = o.ac_id
        LEFT JOIN human_resource h
        ON h.emp_id = o.emp_id
        <where>
            <if test="outbound_date != null">
                AND DATE(o.outbound_date) = DATE(#{outbound_date})
            </if>

            <if test="stock_id != null">
                AND o.stock_id = #{stock_id}
            </if>
            <if test="ac_id != null">
                AND o.ac_id = #{ac_id}
            </if>
            <if test="emp_id != null">
                AND o.emp_id = #{emp_id}
            </if>
            <if test="approval != null">
                AND o.approval = #{approval}
            </if>
        </where>
    </select>

    <!-- 등록 -->
    <insert id="addOutbound"
            parameterType="com.multi.y2k4.vo.inventory.Outbound"
            useGeneratedKeys="true"
            keyProperty="outbound_id"
            keyColumn="outbound_id">
        INSERT INTO outbound
        (outbound_date, stock_id, outbound_qty, ac_id, emp_id, remark, approval)
        VALUES
            (#{outbound_date}, #{stock_id}, #{outbound_qty},
             #{ac_id}, #{emp_id}, #{remark}, #{approval})
    </insert>

    <!-- 단건 조회: ac_name, emp_name 조인 -->
    <select id="selectOutboundById" resultType="com.multi.y2k4.vo.inventory.Outbound">
        SELECT o.*,
            a.ac_name      AS ac_name,
            h.emp_name     AS emp_name
        FROM outbound o
                 LEFT JOIN accounts a
                           ON a.ac_id = o.ac_id
                 LEFT JOIN human_resource h
                           ON h.emp_id = o.emp_id
        WHERE o.outbound_id = #{outbound_id}
    </select>

    <!-- 수정 -->
    <update id="updateOutbound" parameterType="com.multi.y2k4.vo.inventory.Outbound">
        UPDATE outbound
        <set>
            <if test="outbound_date != null"> outbound_date = #{outbound_date}, </if>
            <if test="stock_id      != null"> stock_id      = #{stock_id},      </if>
            <if test="outbound_qty  != null"> outbound_qty  = #{outbound_qty},  </if>
            <if test="ac_id         != null"> ac_id         = #{ac_id},         </if>
            <if test="emp_id        != null"> emp_id        = #{emp_id},        </if>
            <if test="remark        != null"> remark        = #{remark},        </if>
            <if test="approval      != null"> approval      = #{approval},      </if>
        </set>
        WHERE outbound_id = #{outbound_id}
    </update>

    <delete id="deleteOutbound" parameterType="com.multi.y2k4.vo.inventory.Outbound">
        DELETE FROM outbound
        WHERE outbound_id = #{outbound_id}
    </delete>
</mapper>
