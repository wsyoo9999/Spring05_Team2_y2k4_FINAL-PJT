<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>결재 문서 등록</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .form-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea { resize: vertical; height: 100px; }
        .button-group { text-align: right; margin-top: 20px; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button[type="submit"] { background-color: #007bff; color: white; }
        button[type="submit"]:hover { background-color: #0056b3; }
        #close-button { background-color: #6c757d; color: white; margin-left: 10px; }
        #close-button:hover { background-color: #5a6268; }
    </style>
</head>
<body>

<div class="form-container">
    <h2>결재 문서 등록</h2>

    <form id="document-register-form">

        <label for="title">제목</label>
        <input type="text" id="title" name="title" required>

        <label for="requesterId">기안자 ID</label>
        <input type="number" id="requesterId" name="requesterId" value="100" required>

        <label for="content">내용</label>
        <textarea id="content" name="content" required></textarea>

        <div class="button-group">
            <button type="submit">등록</button>
            <button type="button" id="close-button" onclick="window.close()">닫기</button>
        </div>
    </form>
</div>

<script>
    // 폼 제출 이벤트 핸들러
    $('#document-register-form').on('submit', async function(e) {
        e.preventDefault();

        // 폼 데이터를 객체로 변환
        const formData = {
            title: $('#title').val(),
            requesterId: $('#requesterId').val(),
            content: $('#content').val()
        };

        // 부모 창의 finance.js에 정의된 API 호출 함수를 사용
        // (단, 부모 창의 함수를 자식 창에서 호출하기 위해서는 별도의 팝업 통신 로직 필요.
        // 여기서는 부모 창에 정의된 finance.js를 직접 사용한다고 가정)

        const result = await window.opener.finance.handleDocumentRegistration(formData);

        if (result) {
            // 등록 성공 시 팝업 닫고 부모 창 목록 새로고침
            if (window.opener && window.opener.listClick) {
                // listClick 함수가 목록을 새로고침 한다고 가정
                window.opener.listClick({ dataset: { file: 'finance', fn: 'documents_listAll' }});
            }
            window.close();
        }
    });
</script>
</body>
</html>