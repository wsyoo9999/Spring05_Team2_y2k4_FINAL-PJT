<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <title>판매 목록 추가</title>
</head>
<body>
<form method="POST" action="/api/transaction/purchase/add" id="form">
    <label>담당자
        <input type="text" name="emp_id" required>
    </label>
    <label>거래처
        <input type="text" name="client_id" required>
    </label><br>
    <label>주문 수주일
        <input type="date" name="order_date" required>
    </label>
    <label>납기일
        <input type="date" name="del_date" required>
    </label><br>
    <div class = "detail">
        <label>제품명
            <input type="text" name="item_id[]" required>

        </label><!--추후 이름으로 입력 되도록 변경-->
        <label>수량
            <input type="text" name="qty[]" min="1" required>
        </label><br>
    </div>

    <input type="submit" value="입력 완료">
</form>

<input type="button" class ="createForm" value="추가 입력">

</body>

<script>
    const create = document.querySelector(".createForm");
    const detail = document.querySelector(".detail");
    create.addEventListener("click", (e) => {
        const addDataForm = document.createElement('div');
        addDataForm.innerHTML = ` <label>제품명
                                    <input type="text" name="item_id[]" required>
                                    </label>
                                    <label>수량
                                        <input type="number" name="qty[]" min="1" required>
                                    </label><br>`;
        detail.appendChild(addDataForm);
    })

    const form = document.getElementById("form");
    form.addEventListener("submit", async (e) => {
        e.preventDefault();


        const result = await $.ajax({
            url: form.action,
            method: 'POST',
            dataType: 'json',
            data: $(form).serialize()


        });
        if (result === true) {
            alert('입력 성공');
            // 부모 창에 갱신 신호 (선택)
            window.close(); // 알림 확인 후 닫힘
        } else {
            alert('입력 실패');
        }


    })
</script>
</html>
