<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <title>ê²°ì¬ ë¬¸ì„œ ë“±ë¡</title>
    <style>
        /* (documents_detail.htmlê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ì‚¬ìš©) */
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f8f8f8; }
        .detail-card {
            background: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 30px; max-width: 650px; margin: auto;
        }
        h2 { border-bottom: 3px solid #007bff; padding-bottom: 10px; margin-bottom: 25px; color: #007bff; }
        #registerForm label { display: block; margin-top: 15px; font-weight: bold; color: #333; }
        #registerForm input[type="text"], #registerForm textarea, #registerForm input[type="number"] {
            width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; resize: vertical;
        }
        #registerForm button {
            background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 25px;
        }
    </style>
</head>
<body>

<div class="detail-card">
    <h2>â• ì‹ ê·œ ê²°ì¬ ë¬¸ì„œ ë“±ë¡</h2>

    <form id="registerForm">
        <label for="reg_title">ì œëª©:</label>
        <input type="text" id="reg_title" name="title" required>

        <label for="reg_requesterId">ê¸°ì•ˆì ID:</label>
        <input type="number" id="reg_requesterId" name="requesterId" required value="100"> <label for="reg_content">ë¬¸ì„œ ë‚´ìš©:</label>
        <textarea id="reg_content" name="content" rows="5" required></textarea>

        <!-- ì´ ë¶€ë¶„ì€ ì„ì‹œ ë°ì´í„°ì´ë©°, ì‹¤ì œ êµ¬í˜„ ì‹œ ì œê±°í•´ì•¼ í•©ë‹ˆë‹¤. -->
        <input type="hidden" id="reg_slipsList" name="slipsList" value='[]'>

        <button type="submit">ê²°ì¬ ë¬¸ì„œ ë“±ë¡</button>
    </form>
</div>

<script>
    const API_BASE_URL = '/api/finance/documents';

    // í¼ ì œì¶œ (ë“±ë¡) ì´ë²¤íŠ¸ ì²˜ë¦¬ (API 1ë²ˆ)
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        // í¼ ë°ì´í„° ìˆ˜ì§‘
        const docData = {
            title: document.getElementById('reg_title').value,
            requesterId: parseInt(document.getElementById('reg_requesterId').value),
            content: document.getElementById('reg_content').value,
            // ë”ë¯¸ ì „í‘œ ëª©ë¡ (ì‹¤ì œëŠ” ë™ì  ìƒì„± í•„ìš”)
            slipsList: JSON.parse(document.getElementById('reg_slipsList').value)
        };

        try {
            const result = await $.ajax({
                url: API_BASE_URL,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(docData)
            });

            if (result && result.docId) {
                alert(`âœ… ê²°ì¬ ë¬¸ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. (ID: ${result.docId})`);

                // --- ğŸ’¡ ë³€ê²½ëœ ë¡œì§: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ëŒ€ì‹  ëª©ë¡ ê°±ì‹  ë²„íŠ¼ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜ ---
                if (window.opener && !window.opener.closed) {
                    // documents_listAll í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë©”ë‰´ ë²„íŠ¼ì„ ì°¾ì•„ í´ë¦­í•©ë‹ˆë‹¤.
                    const menuButton = window.opener.document.querySelector('.menu[data-fn="documents_listAll"]');
                    if (menuButton) {
                        menuButton.click();
                    }
                }

                window.close(); // íŒì—… ë‹«ê¸°
            } else {
                alert('âŒ ë¬¸ì„œ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }

        } catch (error) {
            console.error('ë¬¸ì„œ ë“±ë¡ ì‹¤íŒ¨:', error);
            alert('âŒ ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì½˜ì†” í™•ì¸)');
        }
    });
</script>
</html>

<script>` ë¸”ë¡ì—ì„œ ì„±ê³µ ì²˜ë¦¬ ë¶€ë¶„ì„ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í–ˆìŠµë‹ˆë‹¤:

**ë³€ê²½ ì „ (ì „ì²´ ìƒˆë¡œê³ ì¹¨)**
```javascript
if (window.opener && !window.opener.closed) {
    window.opener.location.reload();
}
```

**ë³€ê²½ í›„ (ëª©ë¡ë§Œ ê°±ì‹ )**
```javascript
if (window.opener && !window.opener.closed) {
    const menuButton = window.opener.document.querySelector('.menu[data-fn="documents_listAll"]');
    if (menuButton) {
        menuButton.click(); // ë¶€ëª¨ ì°½ì˜ listClick í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ í…Œì´ë¸”ë§Œ ê°±ì‹ 
    }
}