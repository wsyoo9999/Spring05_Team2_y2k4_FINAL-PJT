<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>재고 정보 조회</title>
</head>
<body>
<h1>입고 보기/수정</h1>

<form id="inboundForm">
    <div>
        <label for="inbound_order">입고번호</label>
        <input id="inbound_order" name="inbound_order" type="number" />
    </div>

    <div>
        <label for="stock_id">재고코드</label>
        <input id="stock_id" name="stock_id" type="number" />
    </div>

    <div>
        <label for="inbound_date">입고일</label>
        <!-- VO가 yyyy-MM-dd로 내려오므로 date 입력과 호환 -->
        <input id="inbound_date" name="inbound_date" type="date" />
    </div>

    <div>
        <label for="stock_name">재고명</label>
        <input id="stock_name" name="stock_name" type="text" />
    </div>

    <div>
        <label for="inbound_qty">입고수량</label>
        <input id="inbound_qty" name="inbound_qty" type="number" />
    </div>

    <div>
        <label for="unit_price">단가</label>
        <input id="unit_price" name="unit_price" type="number" />
    </div>

    <div>
        <label for="supplier">공급업체</label>
        <input id="supplier" name="supplier" type="text" />
    </div>

    <div>
        <label for="manager">담당자</label>
        <input id="manager" name="manager" type="text" />
    </div>

    <div>
        <label for="remark">비고</label>
        <input id="remark" name="remark" type="text" style="width:100%; height:100px; padding:8px; box-sizing:border-box;"></input>
    </div>

    <div style="margin-top:10px; text-align:right;">
        <button type="submit" id="edit">수정</button>
    </div>
</form>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    (function () {
        const API_BASE = '/api/inventory/inbound';

        // 1) URL에서 inbound_order 읽기 (예: ?inbound_order=10001)
        const params = new URLSearchParams(location.search);
        const inboundOrder = params.get('inbound_order');

        // 2) 유틸
        function normalize(data) {
            if (Array.isArray(data)) return data[0] || null;
            if (data && Array.isArray(data.rows)) return data.rows[0] || null;
            return data || null;
        }
        function setById(id, v) {
            const el = document.getElementById(id);
            if (el) el.value = (v ?? '');
        }
        const toInt = v => (v === '' || v == null) ? null : parseInt(v, 10);

        // 3) 로드 & 폼 채우기
        async function loadInbound(orderNo) {
            const urls = [
                `${API_BASE}/${encodeURIComponent(orderNo)}`,
                `${API_BASE}?inbound_order=${encodeURIComponent(orderNo)}`
            ];

            for (const url of urls) {
                try {
                    const data = await $.ajax({ url, method: 'GET', dataType: 'json' });
                    const r = normalize(data);
                    if (r) { fillForm(r); return; }
                } catch (e) { /* 다음 URL 시도 */ }
            }
            alert('데이터를 불러오지 못했습니다.');
        }

        function fillForm(r) {
            setById('inbound_order', r.inbound_order);
            setById('stock_id',      r.stock_id);
            // inbound_date는 서버에서 "yyyy-MM-dd" 문자열로 온다고 가정
            setById('inbound_date',  r.inbound_date);
            setById('stock_name',    r.stock_name);
            setById('inbound_qty',   r.inbound_qty);
            setById('unit_price',    r.unit_price);
            setById('supplier',      r.supplier);
            setById('manager',       r.manager);
            setById('remark',        r.remark);

            // PK는 보통 수정 금지
            const pk = document.getElementById('inbound_order');
            if (pk) pk.readOnly = true;
        }

        // 5) 초기 로드
        loadInbound(inboundOrder);
    })();
</script>


</body>
</html>