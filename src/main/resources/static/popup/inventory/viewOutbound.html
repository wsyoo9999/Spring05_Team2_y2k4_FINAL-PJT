<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>출고 정보 조회</title>
</head>
<body>
<h1>출고 보기/수정</h1>

<form id="outboundForm">
    <div>
        <label for="outbound_id">출고번호</label>
        <input id="outbound_id" name="outbound_id" type="number" />
    </div>

    <div>
        <label for="stock_id">재고코드</label>
        <input id="stock_id" name="stock_id" type="number" />
    </div>

    <div>
        <label for="outbound_date">출고일</label>
        <input id="outbound_date" name="outbound_date" type="date" />
    </div>

    <div>
        <label for="outbound_qty">수량</label>
        <input id="outbound_qty" name="outbound_qty" type="number" />
    </div>

    <div>
        <label for="outbound_location">출고처</label>
        <input id="outbound_location" name="outbound_location" type="text" />
    </div>

    <div>
        <label for="manager">담당자</label>
        <input id="manager" name="manager" type="text" />
    </div>

    <!-- 수정된 비고란: textarea → input, 크게 표시 -->
    <div>
        <label for="remark">비고</label>
        <input
                id="remark"
                name="remark"
                type="text"
                style="width:100%; height:44px; padding:8px; box-sizing:border-box;"
                maxlength="200"
                placeholder="비고를 입력하세요"
        />
    </div>

    <div style="margin-top:10px; text-align:right;">
        <button type="submit" id="edit">수정</button>
    </div>
</form>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    (function () {
        const API_BASE = '/api/inventory/outbound';

        // 1) URL에서 outbound_id 읽기 (예: ?outbound_id=5001)
        const params = new URLSearchParams(location.search);
        const outboundId = params.get('outbound_id');

        // 2) 유틸
        function normalize(data) {
            if (Array.isArray(data)) return data[0] || null;
            if (data && Array.isArray(data.rows)) return data.rows[0] || null;
            return data || null;
        }
        function setById(id, v) {
            const el = document.getElementById(id);
            if (el) el.value = (v ?? '');
        }
        const toInt = v => (v === '' || v == null) ? null : parseInt(v, 10);

        // 3) 로드 & 폼 채우기
        async function loadOutbound(id) {

            const urls = [
                `${API_BASE}/${encodeURIComponent(id)}`,
                `${API_BASE}?outbound_id=${encodeURIComponent(id)}`
            ];

            for (const url of urls) {
                try {
                    const data = await $.ajax({ url, method: 'GET', dataType: 'json' });
                    const r = normalize(data);
                    if (r) { fillForm(r); return; }
                } catch (e) { /* 다음 URL 시도 */ }
            }
            alert('데이터를 불러오지 못했습니다.');
        }

        function fillForm(r) {
            setById('outbound_id',       r.outbound_id);
            setById('stock_id',          r.stock_id);
            setById('outbound_date',     r.outbound_date);     // "yyyy-MM-dd"
            setById('outbound_qty',      r.outbound_qty);
            setById('outbound_location', r.outbound_location);
            setById('manager',           r.manager);
            setById('remark',            r.remark);

            // PK는 보통 수정 금지
            const pk = document.getElementById('outbound_id');
            if (pk) pk.readOnly = true;
        }

        // 5) 초기 로드
        loadOutbound(outboundId);
    })();
</script>
</body>
</html>