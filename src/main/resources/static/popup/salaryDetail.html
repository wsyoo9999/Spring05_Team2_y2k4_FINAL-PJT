<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <title>ê¸‰ì—¬ ìƒì„¸ ì •ë³´</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f8f8f8; }
        .detail-card {
            background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px; max-width: 450px; margin: auto;
        }
        h2 { border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; color: #007bff;}
        .info-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 10px; }
        .info-label { font-weight: bold; color: #555; }
        .info-value { text-align: right; }
        .separator { grid-column: 1 / -1; border-top: 1px solid #eee; margin: 10px 0; }
        .total-row { font-size: 1.1em; font-weight: bold; color: #28a745; }
        .deduction { color: red; }
    </style>
</head>
<body>

<div class="detail-card">
    <h2>ğŸ’° ê¸‰ì—¬ ìƒì„¸ ë‚´ì—­</h2>

    <div id="salary-detail-content">
        ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...
    </div>

</div>

<script>
    // ìˆ«ì í¬ë§· í•¨ìˆ˜ (hr.jsì— ìˆëŠ” í•¨ìˆ˜ì™€ ë™ì¼)
    function numberFormat(num) {
        if (num === null || num === undefined) return '0';
        return parseInt(num).toLocaleString('ko-KR');
    }

    // URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ salaryId ê°€ì ¸ì˜¤ê¸°
    function getSalaryIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get('salaryId');
    }

    // API í˜¸ì¶œí•˜ì—¬ ìƒì„¸ ë°ì´í„° ë¡œë“œ
    async function loadSalaryDetail() {
        const salaryId = getSalaryIdFromUrl();
        const contentDiv = document.getElementById('salary-detail-content');

        if (!salaryId) {
            contentDiv.innerHTML = '<p style="color: red;">ğŸš¨ ì˜¤ë¥˜: ê¸‰ì—¬ IDê°€ ì „ë‹¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        try {
            const data = await $.ajax({
                url: `/api/hr/salary/${salaryId}`, // ìƒˆë¡œìš´ API ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
                method: 'GET',
                dataType: 'json'
            });

            if (data && data.salary_id) {
                // ìƒì„¸ ì •ë³´ë¥¼ HTMLë¡œ êµ¬ì„±
                const html = `
                    <div class="info-grid">
                        <div class="info-label">ì§€ê¸‰ì¼ì</div><div class="info-value">${data.payment_date || '-'}</div>
                        <div class="info-label">ì‚¬ë²ˆ</div><div class="info-value">${data.emp_id || '-'}</div>
                        <div class="info-label">ì´ë¦„</div><div class="info-value">${data.emp_name || '-'}</div>
                        <div class="separator"></div>

                        <div class="info-label">ê¸°ë³¸ê¸‰</div><div class="info-value">${numberFormat(data.basic_salary)} ì›</div>
                        <div class="info-label">ìˆ˜ë‹¹</div><div class="info-value">${numberFormat(data.allowance)} ì›</div>
                        <div class="info-label total-row">ì´ ì§€ê¸‰ì•¡</div><div class="info-value total-row">${numberFormat(data.total_gross)} ì›</div>
                        <div class="separator"></div>

                        <div class="info-label">ì´ ê³µì œì•¡</div><div class="info-value deduction">${numberFormat(data.deduction_amount)} ì›</div>
                        <div class="separator"></div>

                        <div class="info-label total-row">ì‹¤ìˆ˜ë ¹ì•¡ (ìµœì¢…)</div><div class="info-value total-row">${numberFormat(data.total_pay)} ì›</div>

                        <div class="separator"></div>
                        <div class="info-label">ì€í–‰ëª…</div><div class="info-value">${data.bank_name || '-'}</div>
                        <div class="info-label">ê³„ì¢Œë²ˆí˜¸</div><div class="info-value">${data.account_number || '-'}</div>
                    </div>
                `;
                contentDiv.innerHTML = html;
            } else {
                contentDiv.innerHTML = `<p class="error-message">ID ${salaryId}ì— ëŒ€í•œ ê¸‰ì—¬ ìƒì„¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }

        } catch (err) {
            console.error("ê¸‰ì—¬ ìƒì„¸ ë¡œë”© ì‹¤íŒ¨:", err);
            contentDiv.innerHTML = '<p style="color: red;">ğŸš¨ ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
        }
    }

    $(document).ready(loadSalaryDetail);
</script>
</html>